<article class="post" itemscope itemtype="http://schema.org/Article">
  <header>
    <h1 itemprop="name"><%= post.title %></h1>
    <% if @post.editable_by? current_user %>
        <nav>
          <ul>
            <li><%= link_to t(:edit), edit_post_path(@post) %></li>
            <li><%= link_to t(:delete), post, method: :delete, data: { confirm: t(:are_you_sure) } %></li>
          </ul>
        </nav>
    <% end %>
  </header>

  <section class="body">
    <% if post.image.url %>
        <figure><%= link_to image_tag(post.image.post, alt: post.title), post.image.url %></figure>
    <% end %>
    <%= simple_format post.body %>
  </section>

  <section class="info">
    <div>
      <span class="author"><%= user_link post.user %></span>,
      <time datetime="<%= post.created_at.w3c %>"><%= post.created_at.strftime('%d.%m.%Y, %H:%M') %></time>
    </div>
  </section>
  
  <%= render 'shared/social' %>

  <section class="comments">
    <% @comment = Comment.new(commentable: post) %>
    <% if post.comments.any? %>
        <h1><%= t(:comments) %></h1>
        <ul class="comments">
          <% post.comments.order('id asc').each do |comment| %>
              <li id="comment-<%= comment.id %>">
                <div>
                  <figure>
                    <%= comment_avatar(comment.user) %>
                    <figcaption><%= user_link(comment.user) %></figcaption>
                  </figure>
                  <time datetime="<%= comment.created_at.w3c %>"><%= comment.created_at.strftime('%d.%m.%Y, %H:%M') %></time>
                </div>

                <div>
                  <%= raw parse_body(comment.body, false, true) %>
                </div>

                <ul class="actions">
                  <li>
                    <div><%= t(:reply) %></div>
                    <div></div>
                  </li>
                </ul>
              </li>
          <% end %>
        </ul>
    <% end %>

    <div class="reply-container">
      <h3><%= t('comment.add') %></h3>

      <div>
        <%= render 'comments/form' %>
      </div>
    </div>
  </section>

</article>
