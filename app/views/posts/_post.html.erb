<% if post.editable_by? current_user %>
    <nav class="options">
      <ul>
        <li><%= link_to t(:edit), edit_post_path(post) %></li>
        <li><%= link_to t(:delete), post, method: :delete, data: { confirm: t(:are_you_sure) } %></li>
      </ul>
    </nav>
<% end %>

<article class="post" itemscope itemtype="http://schema.org/Article">
  <h1 itemprop="name"><%= post.title %></h1>
  <%= render partial: 'controls', locals: { post: post } %>

  <div class="body" itemprop="articleBody">
    <% if post.image.url %>
        <figure><%= link_to image_tag(post.image.url, alt: post.title, itemprop: 'image'), post.image.url %></figure>
    <% end %>
    <%= prepare_post_text post %>
  </div>

  <% if post.tags_cache.any? %>
      <nav class="tags">
        <ul>
          <% post.tags_cache.each do |tag_name| %>
              <li><%= link_to tag_name, tagged_posts_path(tag_name: Canonizer.urlize(tag_name)), rel: 'tag' %></li>
          <% end %>
        </ul>
      </nav>
  <% end %>

  <div class="footer">
    <div class="avatar">
      <%= raw comment_avatar(post.user) %>
    </div>
    <%= render partial: 'shared/author', locals: { user: post.user } %>
    <%= render partial: 'shared/publication_time', locals: { time: post.created_at } %>
    <meta itemprop="commentCount" content="<%= post.comments_count %>"/>
  </div>

  <%= render 'shared/track_data', item: post %>

  <%= render 'shared/social' %>

  <%= render partial: 'comments/list', locals: { commentable: post, comments: post.comments } %>
</article>
