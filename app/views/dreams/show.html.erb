<% content_for :meta_title, t('.title', title: @entity.title || t(:untitled)) %>
<% content_for :meta_description, glimpse(prepare_dream_text(@entity, nil)) %>
<% content_for :meta_type, 'article' %>
<% content_for :meta_type_extension do %>
    <meta property="og:article:published_time" content="<%= @entity.created_at.strftime('%Y-%m-%d') %>" />
    <meta property="og:article:modified_time" content="<%= @entity.updated_at.strftime('%Y-%m-%d') %>" />
    <% unless @entity.user.nil? %>
        <meta property="og:article:author" content="<%= @entity.user.profile_name %>" />
    <% end %>
<% end %>

<%= render partial: 'dreams/adjacent', locals: { dreams: @adjacent } %>
<article class="entity-page dream <%= @entity.privacy %>" itemscope itemtype="http://schema.org/BlogPosting">
  <h1 itemprop="name"><%= @entity.title || t(:untitled) %></h1>

  <meta itemprop="commentCount" content="<%= @entity.comments_count %> "/>
  <meta itemprop="keywords" content="<%= @entity.patterns.map { |tag| tag.name }.join(', ') %> "/>

  <% if @entity.editable_by? current_user %>
      <ul class="actions">
        <li><%= edit_icon edit_dream_path(@entity) %></li>
      </ul>
  <% end %>

  <div class="body" itemprop="articleBody">
    <%= raw prepare_dream_text @entity, current_user %>
  </div>

  <div class="footer">
    <%= user_link @entity.user %>
    <%= time_tag @entity.created_at %>
  </div>
  <%= render partial: 'shared/track', locals: { item: @entity } %>

  <%= render partial: 'comments/list', locals: { comments: @entity.comments.visible.recent, commentable: @entity } %>
</article>
