<article class="entity-page dream <%= dream.privacy %>" itemscope itemtype="http://schema.org/BlogPosting">
  <h1 itemprop="name"><%= dream.title || t(:untitled) %></h1>

  <meta itemprop="commentCount" content="<%= dream.comments_count %> "/>
  <meta itemprop="keywords" content="<%= dream.patterns.map { |tag| tag.name }.join(', ') %> "/>

  <% if dream.editable_by? current_user %>
      <ul class="actions">
        <li><%= edit_icon edit_dream_path(dream) %></li>
      </ul>
  <% end %>

  <div class="body" itemprop="articleBody">
    <%= raw prepare_dream_text dream, current_user %>
  </div>

  <div class="footer">
    <%= user_link dream.user %>
    <%= time_tag dream.created_at %>
  </div>
  <% if dream.needs_interpretation && !dream.interpretation_given %>
      <div class="needs_interpretation"><%= t('activerecord.attributes.dream.needs_interpretation') %></div>
  <% end %>
  <%= render partial: 'shared/track', locals: { item: dream } %>

  <% if dream.owned_by? current_user %>
      <section>
        <table>
          <tr>
            <th><%= t('activerecord.attributes.dream.lucidity') %></th>
            <td><%= dream.lucidity %></td>
          </tr>
          <tr>
            <th><%= t('activerecord.attributes.dream.mood') %></th>
            <td><%= dream.mood %></td>
          </tr>
          <% unless dream.place.nil? %>
              <tr>
                <th><%= t('activerecord.attributes.dream.place') %></th>
                <td><%= link_to dream.place.name, dream.place %></td>
              </tr>
          <% end %>
        </table>
      </section>
  <% end %>

  <%= render partial: 'comments/list', locals: { comments: dream.comments.visible.recent, commentable: dream } %>
</article>
